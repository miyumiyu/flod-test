<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Foldable Switcher (Double Tap)</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            /* テキスト選択などを無効化 */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        #displayImage {
            width: 100%;
            height: 100%;
            object-fit: contain; 
            display: block;
            pointer-events: auto;
        }

        /* 設定メニュー */
        #settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            font-family: sans-serif;
        }

        .upload-btn {
            background: #444;
            color: #fff;
            border: 1px solid #666;
            padding: 15px;
            margin: 10px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 80%;
            text-align: center;
        }

        .close-btn {
            margin-top: 30px;
            background: #d9534f;
            border: none;
        }

        h2 { margin-bottom: 20px; font-size: 18px; }
        p { font-size: 12px; color: #aaa; margin-top: -5px; margin-bottom: 15px; }
    </style>
</head>
<body>
    
    <img id="displayImage" src="1.png" alt="ダブルタップで設定">

    <div id="settings-overlay">
        <h2>画像設定メニュー</h2>
        
        <button class="upload-btn" onclick="document.getElementById('file-normal').click()">
            ① [通常] 画像を選択
        </button>
        <p>現在: <span id="status-normal">1.png (初期)</span></p>

        <button class="upload-btn" onclick="document.getElementById('file-folded').click()">
            ② [折畳] 画像を選択
        </button>
        <p>現在: <span id="status-folded">2.png (初期)</span></p>

        <button class="upload-btn close-btn" onclick="closeSettings()">
            閉じる
        </button>
    </div>

    <input type="file" id="file-normal" accept="image/*" style="display: none;">
    <input type="file" id="file-folded" accept="image/*" style="display: none;">

    <script>
        // --- 設定変数 ---
        let image1Src = '1.png';
        let image2Src = '2.png';
        
        const imgElement = document.getElementById('displayImage');
        const overlay = document.getElementById('settings-overlay');
        let currentImageStr = "";

        // --- 画像切り替え ---
        function switchImage(targetImageSrc) {
            if (currentImageStr !== targetImageSrc) {
                imgElement.src = targetImageSrc;
                currentImageStr = targetImageSrc;
            }
        }

        // 初期表示
        switchImage(image1Src);

        // --- 全画面化＆回転ロック ---
        async function enableFullScreenAndLock() {
            try {
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                }
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock("portrait");
                }
            } catch (err) {
                console.log("Lock failed:", err);
            }
        }

        // --- ★操作ロジック（ダブルタップ対応） ---
        let lastTouchTime = 0;

        // 画面（画像）をタッチした時の処理
        imgElement.addEventListener('touchstart', function(e) {
            // メニューが開いている時は無視
            if (overlay.style.display === 'flex') return;

            const now = new Date().getTime();
            const timeDiff = now - lastTouchTime;

            // 300ミリ秒以内に2回タッチしたらダブルタップとみなす
            if (timeDiff < 300 && timeDiff > 0) {
                // --- ダブルタップ時 ---
                e.preventDefault(); // ズーム等を防ぐ
                openSettings();     // メニューを開く
            } else {
                // --- シングルタップ時 ---
                // 通常の「画像1に戻す」処理を実行
                // e.preventDefault(); // ここで無効化するとスクロール等もできなくなるので、必要に応じて
                
                switchImage(image1Src);
                enableFullScreenAndLock();
            }

            lastTouchTime = now;
        }, {passive: false});


        // --- 折りたたみ検知 (ご提供いただいた動作確認済みロジック) ---
        if (navigator.devicePosture) {
            navigator.devicePosture.addEventListener('change', (event) => {
                switchImage(image2Src);
            });
        } else {
            let lastAspectRatio = window.innerWidth / window.innerHeight;
            window.addEventListener('resize', () => {
                const currentAspectRatio = window.innerWidth / window.innerHeight;
                const ratioChange = Math.abs(currentAspectRatio - lastAspectRatio);
                
                if (ratioChange > 0.3) {
                     switchImage(image2Src);
                }
                lastAspectRatio = currentAspectRatio;
            });
        }

        // --- 設定メニュー関連 ---
        function openSettings() {
            overlay.style.display = 'flex';
        }
        function closeSettings() {
            overlay.style.display = 'none';
        }

        // 画像アップロード処理
        const setupFileLoad = (inputId, isNormal) => {
            document.getElementById(inputId).addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(evt) {
                        const result = evt.target.result;
                        if (isNormal) {
                            image1Src = result;
                            document.getElementById('status-normal').innerText = file.name;
                            switchImage(image1Src);
                        } else {
                            image2Src = result;
                            document.getElementById('status-folded').innerText = file.name;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        };
        setupFileLoad('file-normal', true);
        setupFileLoad('file-folded', false);

    </script>
</body>
</html>
