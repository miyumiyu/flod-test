<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Foldable Image Switcher</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000; /* 背景は黒 */
        }
        #displayImage {
            width: 100%;
            height: 100%;
            /* contain: 画像全体を表示（黒帯が出る可能性あり）
               cover:   画面いっぱいに表示（端が切れる可能性あり）
               お好みで書き換えてください。現在は contain です。
            */
            object-fit: contain; 
            display: block;
            pointer-events: none;
        }
    </style>
</head>
<body>
    
    <img id="displayImage" src="" alt="">

    <script>
        // --- 設定 ---
        const IMAGE_1 = '1.png'; // 通常時
        const IMAGE_2 = '2.png'; // 折りたたみ時
        
        const imgElement = document.getElementById('displayImage');
        let currentImageStr = "";

        // 画像切り替え関数
        function switchImage(targetImage) {
            if (currentImageStr !== targetImage) {
                imgElement.src = targetImage;
                currentImageStr = targetImage;
            }
        }

        // 初期表示
        switchImage(IMAGE_1);

        // --- 全画面化＆回転ロック処理 ---
        async function enableFullScreenAndLock() {
            try {
                // 1. 全画面化 (ドキュメント全体)
                if (!document.fullscreenElement) {
                    await document.documentElement.requestFullscreen();
                }
                
                // 2. 画面回転ロック (縦画面: portrait / 横画面なら: landscape)
                // ※全画面化された後でないと機能しないブラウザが多いです
                if (screen.orientation && screen.orientation.lock) {
                    await screen.orientation.lock("portrait");
                }
            } catch (err) {
                // PCや一部ブラウザではロックできないためエラーは無視します
                console.log("全画面または回転ロックに失敗しました(仕様の可能性があります):", err);
            }
        }

        // --- イベントリスナー ---

        // タップ時の処理（画像1に戻す ＆ 全画面・ロック発動）
        function handleTap(e) {
            // タッチのデフォルト動作を無効化
            if (e.type === 'touchstart') e.preventDefault();
            
            // 画像を戻す
            switchImage(IMAGE_1);
            
            // 全画面＆ロックを実行（ユーザー操作とみなされるこのタイミングで行う）
            enableFullScreenAndLock();
        }

        document.body.addEventListener('click', handleTap);
        document.body.addEventListener('touchstart', handleTap, {passive: false});

        // 折りたたみ検知 (API または リサイズ)
        // 方法A: Device Posture API
        if (navigator.devicePosture) {
            navigator.devicePosture.addEventListener('change', (event) => {
                switchImage(IMAGE_2);
            });
        } 
        // 方法B: リサイズ検知 (フォールバック)
        else {
            let lastAspectRatio = window.innerWidth / window.innerHeight;
            window.addEventListener('resize', () => {
                const currentAspectRatio = window.innerWidth / window.innerHeight;
                const ratioChange = Math.abs(currentAspectRatio - lastAspectRatio);
                
                if (ratioChange > 0.3) {
                     switchImage(IMAGE_2);
                }
                lastAspectRatio = currentAspectRatio;
            });
        }
    </script>
</body>
</html>
